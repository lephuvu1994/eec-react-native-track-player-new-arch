"use strict";

var _globals = require("@jest/globals");
var _fsExtra = _interopRequireDefault(require("fs-extra"));
var _nodePath = _interopRequireDefault(require("node:path"));
var _patchCodegen = require("../utils/patchCodegen");
var _mockFs = _interopRequireDefault(require("mock-fs"));
function _interopRequireDefault(e) { return e && e.__esModule ? e : { default: e }; }
const mockPackageJson = {
  codegenConfig: {
    outputDir: {
      android: 'android/generated'
    },
    android: {
      javaPackageName: 'com.bobtest'
    }
  }
};
const mockReport = {
  info: console.log,
  warn: console.log,
  error: console.log,
  success: console.log
};
const mockJavaSpec = `
/**
 * Some comment
 */

package com.bobtest;

import com.example.exampleimport;

class SomeClass {
  public void someMethod() {
    // some code
  }
}`;
const mockProjectPath = _nodePath.default.resolve(__dirname, 'mockProject');
const mockCodegenSpecsPath = _nodePath.default.resolve(mockProjectPath, 'android/generated/java/com/facebook/fbreact/specs');
(0, _globals.describe)('patchCodegen', () => {
  (0, _globals.beforeEach)(() => {
    (0, _mockFs.default)({
      [mockProjectPath]: {
        'package.json': JSON.stringify(mockPackageJson)
      },
      [mockCodegenSpecsPath]: {
        'NativeBobtestSpec.java': mockJavaSpec
      }
    });
  });
  (0, _globals.afterEach)(() => {
    _mockFs.default.restore();
  });
  (0, _globals.it)('moves the files to correct dir', async () => {
    await (0, _patchCodegen.patchCodegen)(mockProjectPath, mockPackageJson, mockReport);
    const expectedDir = _nodePath.default.resolve(mockProjectPath, 'android/generated/java/com/bobtest');
    (0, _globals.expect)(await _fsExtra.default.pathExists(expectedDir)).toBe(true);
  });
  (0, _globals.it)('replaces the package name in the files', async () => {
    await (0, _patchCodegen.patchCodegen)(mockProjectPath, mockPackageJson, mockReport);
    const expectedDir = _nodePath.default.resolve(mockProjectPath, 'android/generated/java/com/bobtest');
    const expectedFile = _nodePath.default.resolve(expectedDir, 'NativeBobtestSpec.java');
    const fileContent = await _fsExtra.default.readFile(expectedFile, 'utf8');
    (0, _globals.expect)(fileContent).toContain('package com.bobtest;');
  });
  (0, _globals.it)('removes the old package dir', async () => {
    await (0, _patchCodegen.patchCodegen)(mockProjectPath, mockPackageJson, mockReport);
    (0, _globals.expect)(await _fsExtra.default.pathExists(mockCodegenSpecsPath)).toBe(false);
  });
});
//# sourceMappingURL=patchCodegen.test.js.map