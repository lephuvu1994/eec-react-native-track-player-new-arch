{"version":3,"file":"codegen.js","names":["_kleur","_interopRequireDefault","require","_patchCodegen","_fsExtra","_path","_del","_runRNCCli","e","__esModule","default","build","root","report","packageJsonPath","path","resolve","packageJson","fs","readJson","codegenIosPath","codegenConfig","outputDir","ios","info","kleur","blue","relative","del","codegenAndroidPath","android","runRNCCli","patchCodegen","success","stdout","error","toString","message","includes","process","exit"],"sources":["../../src/targets/codegen.ts"],"sourcesContent":["import kleur from 'kleur';\nimport type { Input } from '../types';\nimport { patchCodegen } from '../utils/patchCodegen';\nimport fs from 'fs-extra';\nimport path from 'path';\nimport del from 'del';\nimport { runRNCCli } from '../utils/runRNCCli';\n\ntype Options = Input;\n\nexport default async function build({ root, report }: Options) {\n  const packageJsonPath = path.resolve(root, 'package.json');\n  const packageJson = await fs.readJson(packageJsonPath);\n\n  const codegenIosPath = packageJson.codegenConfig?.outputDir?.ios;\n  if (codegenIosPath != null) {\n    report.info(\n      `Cleaning up previous iOS codegen native code at ${kleur.blue(\n        path.relative(root, codegenIosPath)\n      )}`\n    );\n    await del([codegenIosPath]);\n  }\n\n  const codegenAndroidPath = packageJson.codegenConfig?.outputDir?.android;\n  if (codegenAndroidPath != null) {\n    report.info(\n      `Cleaning up previous Android codegen native code at ${kleur.blue(\n        path.relative(root, codegenAndroidPath)\n      )}`\n    );\n    await del([codegenAndroidPath]);\n  }\n\n  try {\n    await runRNCCli(['codegen']);\n\n    await patchCodegen(root, packageJson, report);\n\n    report.success('Generated native code with codegen');\n  } catch (e: unknown) {\n    if (e != null && typeof e === 'object') {\n      if ('stdout' in e && e.stdout != null) {\n        report.error(\n          `Errors found while generating codegen files:\\n${e.stdout.toString()}`\n        );\n      } else if ('message' in e && typeof e.message === 'string') {\n        if (\n          e.message.includes(\n            \"Error: Cannot find module '@react-native-community/cli/package.json'\"\n          )\n        ) {\n          report.error(\n            \"You don't have `@react-native-community/cli` in your root package's dev dependencies. Please install it and make sure it uses the same version as your application.\"\n          );\n        } else {\n          report.error(e.message);\n        }\n      } else {\n        throw e;\n      }\n    } else {\n      throw e;\n    }\n\n    process.exit(1);\n  }\n}\n"],"mappings":";;;;;;AAAA,IAAAA,MAAA,GAAAC,sBAAA,CAAAC,OAAA;AAEA,IAAAC,aAAA,GAAAD,OAAA;AACA,IAAAE,QAAA,GAAAH,sBAAA,CAAAC,OAAA;AACA,IAAAG,KAAA,GAAAJ,sBAAA,CAAAC,OAAA;AACA,IAAAI,IAAA,GAAAL,sBAAA,CAAAC,OAAA;AACA,IAAAK,UAAA,GAAAL,OAAA;AAA+C,SAAAD,uBAAAO,CAAA,WAAAA,CAAA,IAAAA,CAAA,CAAAC,UAAA,GAAAD,CAAA,KAAAE,OAAA,EAAAF,CAAA;AAIhC,eAAeG,KAAKA,CAAC;EAAEC,IAAI;EAAEC;AAAgB,CAAC,EAAE;EAC7D,MAAMC,eAAe,GAAGC,aAAI,CAACC,OAAO,CAACJ,IAAI,EAAE,cAAc,CAAC;EAC1D,MAAMK,WAAW,GAAG,MAAMC,gBAAE,CAACC,QAAQ,CAACL,eAAe,CAAC;EAEtD,MAAMM,cAAc,GAAGH,WAAW,CAACI,aAAa,EAAEC,SAAS,EAAEC,GAAG;EAChE,IAAIH,cAAc,IAAI,IAAI,EAAE;IAC1BP,MAAM,CAACW,IAAI,CACT,mDAAmDC,cAAK,CAACC,IAAI,CAC3DX,aAAI,CAACY,QAAQ,CAACf,IAAI,EAAEQ,cAAc,CACpC,CAAC,EACH,CAAC;IACD,MAAM,IAAAQ,YAAG,EAAC,CAACR,cAAc,CAAC,CAAC;EAC7B;EAEA,MAAMS,kBAAkB,GAAGZ,WAAW,CAACI,aAAa,EAAEC,SAAS,EAAEQ,OAAO;EACxE,IAAID,kBAAkB,IAAI,IAAI,EAAE;IAC9BhB,MAAM,CAACW,IAAI,CACT,uDAAuDC,cAAK,CAACC,IAAI,CAC/DX,aAAI,CAACY,QAAQ,CAACf,IAAI,EAAEiB,kBAAkB,CACxC,CAAC,EACH,CAAC;IACD,MAAM,IAAAD,YAAG,EAAC,CAACC,kBAAkB,CAAC,CAAC;EACjC;EAEA,IAAI;IACF,MAAM,IAAAE,oBAAS,EAAC,CAAC,SAAS,CAAC,CAAC;IAE5B,MAAM,IAAAC,0BAAY,EAACpB,IAAI,EAAEK,WAAW,EAAEJ,MAAM,CAAC;IAE7CA,MAAM,CAACoB,OAAO,CAAC,oCAAoC,CAAC;EACtD,CAAC,CAAC,OAAOzB,CAAU,EAAE;IACnB,IAAIA,CAAC,IAAI,IAAI,IAAI,OAAOA,CAAC,KAAK,QAAQ,EAAE;MACtC,IAAI,QAAQ,IAAIA,CAAC,IAAIA,CAAC,CAAC0B,MAAM,IAAI,IAAI,EAAE;QACrCrB,MAAM,CAACsB,KAAK,CACV,iDAAiD3B,CAAC,CAAC0B,MAAM,CAACE,QAAQ,CAAC,CAAC,EACtE,CAAC;MACH,CAAC,MAAM,IAAI,SAAS,IAAI5B,CAAC,IAAI,OAAOA,CAAC,CAAC6B,OAAO,KAAK,QAAQ,EAAE;QAC1D,IACE7B,CAAC,CAAC6B,OAAO,CAACC,QAAQ,CAChB,sEACF,CAAC,EACD;UACAzB,MAAM,CAACsB,KAAK,CACV,qKACF,CAAC;QACH,CAAC,MAAM;UACLtB,MAAM,CAACsB,KAAK,CAAC3B,CAAC,CAAC6B,OAAO,CAAC;QACzB;MACF,CAAC,MAAM;QACL,MAAM7B,CAAC;MACT;IACF,CAAC,MAAM;MACL,MAAMA,CAAC;IACT;IAEA+B,OAAO,CAACC,IAAI,CAAC,CAAC,CAAC;EACjB;AACF","ignoreList":[]}