{"version":3,"file":"patchCodegen.js","names":["_fsExtra","_interopRequireDefault","require","_path","e","__esModule","default","CODEGEN_DOCS","patchCodegen","projectPath","packageJson","report","codegenAndroidPath","codegenConfig","outputDir","android","Error","path","resolve","fs","pathExists","codegenJavaPackageName","javaPackageName","codegenJavaPath","info","javaFiles","readdir","Promise","all","map","file","filePath","fileContent","readFile","newFileContent","replace","writeFile","newPackagePath","mkdir","recursive","newFilePath","rename","rm"],"sources":["../../src/utils/patchCodegen.ts"],"sourcesContent":["import fs from 'fs-extra';\nimport path from 'path';\nimport type { Report } from '../types';\n\nconst CODEGEN_DOCS =\n  'https://github.com/reactwg/react-native-new-architecture/blob/main/docs/enable-libraries-prerequisites.md#configure-codegen';\n\n/**\n * Currently, running react-native codegen generates java files with package name `com.facebook.fbreact.specs`.\n * This is a known issue in react-native itself.\n * You can find the relevant line here: https://github.com/facebook/react-native/blob/dc460147bb00d6f912cc0a829f8040d85faeeb13/packages/react-native/scripts/codegen/generate-artifacts-executor.js#L459.\n * To workaround, this function renames the package name to the one provided in the codegenConfig.\n * @throws if codegenConfig.outputDir.android or codegenConfig.android.javaPackageName is not defined in package.json\n * @throws if the codegenAndroidPath does not exist\n */\nexport async function patchCodegen(\n  projectPath: string,\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  packageJson: any,\n  report: Report\n) {\n  let codegenAndroidPath: string | undefined =\n    packageJson.codegenConfig.outputDir.android;\n  if (!codegenAndroidPath) {\n    throw new Error(\n      `Your package.json doesn't contain codegenConfig.outputDir.android. Please see ${CODEGEN_DOCS}`\n    );\n  }\n  codegenAndroidPath = path.resolve(projectPath, codegenAndroidPath);\n\n  if (!(await fs.pathExists(codegenAndroidPath))) {\n    throw new Error(\n      `The codegen android path defined in your package.json: ${codegenAndroidPath} doesnt' exist.`\n    );\n  }\n\n  const codegenJavaPackageName: string | undefined =\n    packageJson.codegenConfig.android.javaPackageName;\n  if (!codegenJavaPackageName) {\n    throw new Error(\n      `Your package.json doesn't contain codegenConfig.android.javaPackageName. Please see ${CODEGEN_DOCS}`\n    );\n  }\n\n  const codegenJavaPath = path.resolve(\n    codegenAndroidPath,\n    `java/com/facebook/fbreact/specs`\n  );\n\n  // If this issue is ever fixed in react-native, this check will prevent the patching from running.\n  if (!(await fs.pathExists(codegenJavaPath))) {\n    report.info(\n      `Could not find ${codegenJavaPath}. Skipping patching codegen java files.`\n    );\n    return;\n  }\n\n  const javaFiles = await fs.readdir(codegenJavaPath);\n\n  await Promise.all(\n    javaFiles.map(async (file) => {\n      const filePath = path.resolve(codegenJavaPath, file);\n      const fileContent = await fs.readFile(filePath, 'utf8');\n\n      const newFileContent = fileContent.replace(\n        'package com.facebook.fbreact.specs',\n        `package ${codegenJavaPackageName}`\n      );\n\n      await fs.writeFile(filePath, newFileContent);\n    })\n  );\n\n  const newPackagePath = path.resolve(\n    codegenAndroidPath,\n    `java/${codegenJavaPackageName.replace(/\\./g, '/')}`\n  );\n\n  if (!(await fs.pathExists(newPackagePath))) {\n    await fs.mkdir(newPackagePath, { recursive: true });\n  }\n\n  await Promise.all(\n    javaFiles.map(async (file) => {\n      const filePath = path.resolve(codegenJavaPath, file);\n      const newFilePath = path.resolve(newPackagePath, file);\n\n      await fs.rename(filePath, newFilePath);\n    })\n  );\n\n  await fs.rm(path.resolve(codegenAndroidPath, 'java/com/facebook'), {\n    recursive: true,\n  });\n}\n"],"mappings":"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","ignoreList":[]}